{
  "title": "简单前后端同构",
  "date": "2018-02-28T00:00:00.000Z",
  "tags": [],
  "draft": false,
  "body": {
    "raw": "\n# 什么是前后端同构\n\n明确三个概念：\n- **后端渲染**：指传统的 ASP、Java 或 PHP 的渲染机制。\n- **前端渲染**：指使用 JS 来渲染页面大部分内容，代表是现在流行的 SPA 单页面应用。\n- **同构渲染**：指前后端共用 JS，首次渲染时使用 Node.js 来直出 HTML。\n\n一般来说，同构渲染是介于前后端中的共有部分。\n\n## 为什么需要前后端同构\n\n之前流行前后端分离，现在为什么又要做前后端同构？\n\n原因是现在流行的 SPA 前端单页面应用比较沉重，首次访问需要加载文件较多，第一次加载过慢，用户需要等待前端进行页面渲染。而且不利于 SEO 及缓存，并且有一定的开发门槛。\n\n前后端同构通过复用模板和 JS 文件，让一份代码可以同时运行在服务器和浏览器。首次渲染使用 Node.js 渲染页面，之后使用 SPA 路由跳转。这可以有效减少用户首次访问的等待时间，并且对 SEO 比较友好，也便于缓存。\n\n---\n\n# 项目简介\n\n本前后端同构项目主要分为两个部分：\n1. **基于 koa2 的渲染服务器**\n2. **基于原生 JS 和 zepto 的前端 SPA**\n\n项目的特点：\n- 不使用 Vue 和 React 等框架，门槛低，开发速度快，便于上手，比较轻巧。\n- 核心的 router 部分只有一百行左右的代码。\n- 适用于页面交互较少，变化不频繁的场景下，可以有效提升性能和加载速度。\n\n---\n\n# 前端部分\n\n前端部分的核心是路由部分，具体实现可以基于 `history API` 或 `hash`。网上有很多实现，这次主要讲下架构。\n\n前端部分采用 **MVC 分层结构**。\n\n## Router 层\n\nRouter 层主要工作：\n- 创建路由实例\n- 调用路由的 `get` 方法\n- 给特定页面绑定来自 control 层的函数\n\n代码形式如下：\n\n```javascript\nimport control from '../control'\n// 路由的构造函数支持传入渲染函数、路由的全局名称、路由跳转前调用的钩子\nrouter = new Router(render, 'ROUTER', beforeFn)\nrouter.get('/page/a', control.pageA)\n\n```\n\nControl 层\n\nControl 层主要负责：\n\t•\t加载与后端共有的渲染模板和渲染数据\n\t•\t渲染出页面后运行页面函数\n\n```javascript\nlet control = {\n  pageA(req, res) {\n    // webpack 的动态加载，代码分割功能\n    import(/* webpackChunkName: \"pageA\" */'script/pageA').then(module => {\n      // 检测该页面是否已有服务器渲染好，是的话直接运行 module.default\n      // 否则加载模板和数据进行渲染，最后再调用页面函数\n      if (this.needRender(module.default)) {\n        // 加载数据时访问的地址就是当前准备渲染的页面地址，只是加上了 json=1 的参数\n        loadData('pageA').then(data =>\n          res.render(xtpl, data, module.default))\n      }\n    })\n  }\n}\n\n// 捕捉 webpack 热更新，让它只进行相当于页面跳转的操作而不是刷新页面\nif (module.hot) {\n  module.hot.accept(['script/pageA'], () => {\n    control[ROUTER.req.currentControl].call(ROUTER, null, ROUTER.res)\n  })\n}\n```\n\nView 层\n\nView 层即模板，这里使用的是 xtpl 模板，在服务器环境和前端环境下都支持渲染页面。\n\n页面函数形式如下：\n\n```javascript\nexport default () => {\n  window.addEventListener('scroll', fn)\n  // 页面函数支持返回一个卸载函数，在页面离开的时候会被调用\n  // 主要用于内存的释放、定时器的清除、事件监听的移除等等\n  return function () {\n    window.removeEventListener('scroll', fn)\n  }\n}\n```\n\n后端部分\n\n后端部分使用 koa2 搭建渲染服务器。\n\n在收到前端传来的页面请求时：\n\t1.\t向 API 服务器请求数据。\n\t2.\t识别页面请求是否带有 json=1 的参数：\n\t•\t如果带有参数：为前端路由跳转时的请求，直接返回数据即可。\n\t•\t如果没有带参数：加载与前端共用的模板，配合数据进行渲染，发送到浏览器。",
    "code": "var Component=(()=>{var h=Object.create;var l=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var w=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports),g=(a,n)=>{for(var c in n)l(a,c,{get:n[c],enumerable:!0})},o=(a,n,c,t)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let s of u(n))!k.call(a,s)&&s!==c&&l(a,s,{get:()=>n[s],enumerable:!(t=m(n,s))||t.enumerable});return a};var f=(a,n,c)=>(c=a!=null?h(N(a)):{},o(n||!a||!a.__esModule?l(c,\"default\",{value:a,enumerable:!0}):c,a)),y=a=>o(l({},\"__esModule\",{value:!0}),a);var r=w((M,i)=>{i.exports=_jsx_runtime});var x={};g(x,{default:()=>p,frontmatter:()=>v});var e=f(r()),v={title:\"\\u7B80\\u5355\\u524D\\u540E\\u7AEF\\u540C\\u6784\",date:\"2018-02-28\",draft:!1};function d(a){let n={a:\"a\",code:\"code\",h1:\"h1\",h2:\"h2\",hr:\"hr\",li:\"li\",ol:\"ol\",p:\"p\",path:\"path\",pre:\"pre\",span:\"span\",strong:\"strong\",svg:\"svg\",ul:\"ul\",...a.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h1,{className:\"content-header\",id:\"\\u4EC0\\u4E48\\u662F\\u524D\\u540E\\u7AEF\\u540C\\u6784\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#\\u4EC0\\u4E48\\u662F\\u524D\\u540E\\u7AEF\\u540C\\u6784\",tabIndex:\"-1\",children:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.span,{className:\"content-header-link\",children:(0,e.jsxs)(n.svg,{className:\"h-5 linkicon w-5\",fill:\"currentColor\",viewBox:\"0 0 20 20\",xmlns:\"http://www.w3.org/2000/svg\",children:[(0,e.jsx)(n.path,{d:\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}),(0,e.jsx)(n.path,{d:\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"})]})})})}),\"\\u4EC0\\u4E48\\u662F\\u524D\\u540E\\u7AEF\\u540C\\u6784\"]}),(0,e.jsx)(n.p,{children:\"\\u660E\\u786E\\u4E09\\u4E2A\\u6982\\u5FF5\\uFF1A\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u540E\\u7AEF\\u6E32\\u67D3\"}),\"\\uFF1A\\u6307\\u4F20\\u7EDF\\u7684 ASP\\u3001Java \\u6216 PHP \\u7684\\u6E32\\u67D3\\u673A\\u5236\\u3002\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u524D\\u7AEF\\u6E32\\u67D3\"}),\"\\uFF1A\\u6307\\u4F7F\\u7528 JS \\u6765\\u6E32\\u67D3\\u9875\\u9762\\u5927\\u90E8\\u5206\\u5185\\u5BB9\\uFF0C\\u4EE3\\u8868\\u662F\\u73B0\\u5728\\u6D41\\u884C\\u7684 SPA \\u5355\\u9875\\u9762\\u5E94\\u7528\\u3002\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u540C\\u6784\\u6E32\\u67D3\"}),\"\\uFF1A\\u6307\\u524D\\u540E\\u7AEF\\u5171\\u7528 JS\\uFF0C\\u9996\\u6B21\\u6E32\\u67D3\\u65F6\\u4F7F\\u7528 Node.js \\u6765\\u76F4\\u51FA HTML\\u3002\"]})]}),(0,e.jsx)(n.p,{children:\"\\u4E00\\u822C\\u6765\\u8BF4\\uFF0C\\u540C\\u6784\\u6E32\\u67D3\\u662F\\u4ECB\\u4E8E\\u524D\\u540E\\u7AEF\\u4E2D\\u7684\\u5171\\u6709\\u90E8\\u5206\\u3002\"}),(0,e.jsxs)(n.h2,{className:\"content-header\",id:\"\\u4E3A\\u4EC0\\u4E48\\u9700\\u8981\\u524D\\u540E\\u7AEF\\u540C\\u6784\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#\\u4E3A\\u4EC0\\u4E48\\u9700\\u8981\\u524D\\u540E\\u7AEF\\u540C\\u6784\",tabIndex:\"-1\",children:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.span,{className:\"content-header-link\",children:(0,e.jsxs)(n.svg,{className:\"h-5 linkicon w-5\",fill:\"currentColor\",viewBox:\"0 0 20 20\",xmlns:\"http://www.w3.org/2000/svg\",children:[(0,e.jsx)(n.path,{d:\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}),(0,e.jsx)(n.path,{d:\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"})]})})})}),\"\\u4E3A\\u4EC0\\u4E48\\u9700\\u8981\\u524D\\u540E\\u7AEF\\u540C\\u6784\"]}),(0,e.jsx)(n.p,{children:\"\\u4E4B\\u524D\\u6D41\\u884C\\u524D\\u540E\\u7AEF\\u5206\\u79BB\\uFF0C\\u73B0\\u5728\\u4E3A\\u4EC0\\u4E48\\u53C8\\u8981\\u505A\\u524D\\u540E\\u7AEF\\u540C\\u6784\\uFF1F\"}),(0,e.jsx)(n.p,{children:\"\\u539F\\u56E0\\u662F\\u73B0\\u5728\\u6D41\\u884C\\u7684 SPA \\u524D\\u7AEF\\u5355\\u9875\\u9762\\u5E94\\u7528\\u6BD4\\u8F83\\u6C89\\u91CD\\uFF0C\\u9996\\u6B21\\u8BBF\\u95EE\\u9700\\u8981\\u52A0\\u8F7D\\u6587\\u4EF6\\u8F83\\u591A\\uFF0C\\u7B2C\\u4E00\\u6B21\\u52A0\\u8F7D\\u8FC7\\u6162\\uFF0C\\u7528\\u6237\\u9700\\u8981\\u7B49\\u5F85\\u524D\\u7AEF\\u8FDB\\u884C\\u9875\\u9762\\u6E32\\u67D3\\u3002\\u800C\\u4E14\\u4E0D\\u5229\\u4E8E SEO \\u53CA\\u7F13\\u5B58\\uFF0C\\u5E76\\u4E14\\u6709\\u4E00\\u5B9A\\u7684\\u5F00\\u53D1\\u95E8\\u69DB\\u3002\"}),(0,e.jsx)(n.p,{children:\"\\u524D\\u540E\\u7AEF\\u540C\\u6784\\u901A\\u8FC7\\u590D\\u7528\\u6A21\\u677F\\u548C JS \\u6587\\u4EF6\\uFF0C\\u8BA9\\u4E00\\u4EFD\\u4EE3\\u7801\\u53EF\\u4EE5\\u540C\\u65F6\\u8FD0\\u884C\\u5728\\u670D\\u52A1\\u5668\\u548C\\u6D4F\\u89C8\\u5668\\u3002\\u9996\\u6B21\\u6E32\\u67D3\\u4F7F\\u7528 Node.js \\u6E32\\u67D3\\u9875\\u9762\\uFF0C\\u4E4B\\u540E\\u4F7F\\u7528 SPA \\u8DEF\\u7531\\u8DF3\\u8F6C\\u3002\\u8FD9\\u53EF\\u4EE5\\u6709\\u6548\\u51CF\\u5C11\\u7528\\u6237\\u9996\\u6B21\\u8BBF\\u95EE\\u7684\\u7B49\\u5F85\\u65F6\\u95F4\\uFF0C\\u5E76\\u4E14\\u5BF9 SEO \\u6BD4\\u8F83\\u53CB\\u597D\\uFF0C\\u4E5F\\u4FBF\\u4E8E\\u7F13\\u5B58\\u3002\"}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.h1,{className:\"content-header\",id:\"\\u9879\\u76EE\\u7B80\\u4ECB\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#\\u9879\\u76EE\\u7B80\\u4ECB\",tabIndex:\"-1\",children:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.span,{className:\"content-header-link\",children:(0,e.jsxs)(n.svg,{className:\"h-5 linkicon w-5\",fill:\"currentColor\",viewBox:\"0 0 20 20\",xmlns:\"http://www.w3.org/2000/svg\",children:[(0,e.jsx)(n.path,{d:\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}),(0,e.jsx)(n.path,{d:\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"})]})})})}),\"\\u9879\\u76EE\\u7B80\\u4ECB\"]}),(0,e.jsx)(n.p,{children:\"\\u672C\\u524D\\u540E\\u7AEF\\u540C\\u6784\\u9879\\u76EE\\u4E3B\\u8981\\u5206\\u4E3A\\u4E24\\u4E2A\\u90E8\\u5206\\uFF1A\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsx)(n.strong,{children:\"\\u57FA\\u4E8E koa2 \\u7684\\u6E32\\u67D3\\u670D\\u52A1\\u5668\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.strong,{children:\"\\u57FA\\u4E8E\\u539F\\u751F JS \\u548C zepto \\u7684\\u524D\\u7AEF SPA\"})})]}),(0,e.jsx)(n.p,{children:\"\\u9879\\u76EE\\u7684\\u7279\\u70B9\\uFF1A\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"\\u4E0D\\u4F7F\\u7528 Vue \\u548C React \\u7B49\\u6846\\u67B6\\uFF0C\\u95E8\\u69DB\\u4F4E\\uFF0C\\u5F00\\u53D1\\u901F\\u5EA6\\u5FEB\\uFF0C\\u4FBF\\u4E8E\\u4E0A\\u624B\\uFF0C\\u6BD4\\u8F83\\u8F7B\\u5DE7\\u3002\"}),(0,e.jsx)(n.li,{children:\"\\u6838\\u5FC3\\u7684 router \\u90E8\\u5206\\u53EA\\u6709\\u4E00\\u767E\\u884C\\u5DE6\\u53F3\\u7684\\u4EE3\\u7801\\u3002\"}),(0,e.jsx)(n.li,{children:\"\\u9002\\u7528\\u4E8E\\u9875\\u9762\\u4EA4\\u4E92\\u8F83\\u5C11\\uFF0C\\u53D8\\u5316\\u4E0D\\u9891\\u7E41\\u7684\\u573A\\u666F\\u4E0B\\uFF0C\\u53EF\\u4EE5\\u6709\\u6548\\u63D0\\u5347\\u6027\\u80FD\\u548C\\u52A0\\u8F7D\\u901F\\u5EA6\\u3002\"})]}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.h1,{className:\"content-header\",id:\"\\u524D\\u7AEF\\u90E8\\u5206\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#\\u524D\\u7AEF\\u90E8\\u5206\",tabIndex:\"-1\",children:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.span,{className:\"content-header-link\",children:(0,e.jsxs)(n.svg,{className:\"h-5 linkicon w-5\",fill:\"currentColor\",viewBox:\"0 0 20 20\",xmlns:\"http://www.w3.org/2000/svg\",children:[(0,e.jsx)(n.path,{d:\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}),(0,e.jsx)(n.path,{d:\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"})]})})})}),\"\\u524D\\u7AEF\\u90E8\\u5206\"]}),(0,e.jsxs)(n.p,{children:[\"\\u524D\\u7AEF\\u90E8\\u5206\\u7684\\u6838\\u5FC3\\u662F\\u8DEF\\u7531\\u90E8\\u5206\\uFF0C\\u5177\\u4F53\\u5B9E\\u73B0\\u53EF\\u4EE5\\u57FA\\u4E8E \",(0,e.jsx)(n.code,{children:\"history API\"}),\" \\u6216 \",(0,e.jsx)(n.code,{children:\"hash\"}),\"\\u3002\\u7F51\\u4E0A\\u6709\\u5F88\\u591A\\u5B9E\\u73B0\\uFF0C\\u8FD9\\u6B21\\u4E3B\\u8981\\u8BB2\\u4E0B\\u67B6\\u6784\\u3002\"]}),(0,e.jsxs)(n.p,{children:[\"\\u524D\\u7AEF\\u90E8\\u5206\\u91C7\\u7528 \",(0,e.jsx)(n.strong,{children:\"MVC \\u5206\\u5C42\\u7ED3\\u6784\"}),\"\\u3002\"]}),(0,e.jsxs)(n.h2,{className:\"content-header\",id:\"router-\\u5C42\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#router-\\u5C42\",tabIndex:\"-1\",children:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.span,{className:\"content-header-link\",children:(0,e.jsxs)(n.svg,{className:\"h-5 linkicon w-5\",fill:\"currentColor\",viewBox:\"0 0 20 20\",xmlns:\"http://www.w3.org/2000/svg\",children:[(0,e.jsx)(n.path,{d:\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}),(0,e.jsx)(n.path,{d:\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"})]})})})}),\"Router \\u5C42\"]}),(0,e.jsx)(n.p,{children:\"Router \\u5C42\\u4E3B\\u8981\\u5DE5\\u4F5C\\uFF1A\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"\\u521B\\u5EFA\\u8DEF\\u7531\\u5B9E\\u4F8B\"}),(0,e.jsxs)(n.li,{children:[\"\\u8C03\\u7528\\u8DEF\\u7531\\u7684 \",(0,e.jsx)(n.code,{children:\"get\"}),\" \\u65B9\\u6CD5\"]}),(0,e.jsx)(n.li,{children:\"\\u7ED9\\u7279\\u5B9A\\u9875\\u9762\\u7ED1\\u5B9A\\u6765\\u81EA control \\u5C42\\u7684\\u51FD\\u6570\"})]}),(0,e.jsx)(n.p,{children:\"\\u4EE3\\u7801\\u5F62\\u5F0F\\u5982\\u4E0B\\uFF1A\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,e.jsx)(n.span,{className:\"token imports\",children:\"control\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'../control'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// \\u8DEF\\u7531\\u7684\\u6784\\u9020\\u51FD\\u6570\\u652F\\u6301\\u4F20\\u5165\\u6E32\\u67D3\\u51FD\\u6570\\u3001\\u8DEF\\u7531\\u7684\\u5168\\u5C40\\u540D\\u79F0\\u3001\\u8DEF\\u7531\\u8DF3\\u8F6C\\u524D\\u8C03\\u7528\\u7684\\u94A9\\u5B50\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"router \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Router\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"render\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'ROUTER'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" beforeFn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"router\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'/page/a'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" control\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"pageA\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`})]})}),(0,e.jsx)(n.p,{children:\"Control \\u5C42\"}),(0,e.jsx)(n.p,{children:\"Control \\u5C42\\u4E3B\\u8981\\u8D1F\\u8D23\\uFF1A \\u2022 \\u52A0\\u8F7D\\u4E0E\\u540E\\u7AEF\\u5171\\u6709\\u7684\\u6E32\\u67D3\\u6A21\\u677F\\u548C\\u6E32\\u67D3\\u6570\\u636E \\u2022 \\u6E32\\u67D3\\u51FA\\u9875\\u9762\\u540E\\u8FD0\\u884C\\u9875\\u9762\\u51FD\\u6570\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" control \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function\",children:\"pageA\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token parameter\",children:[\"req\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" res\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// webpack \\u7684\\u52A8\\u6001\\u52A0\\u8F7D\\uFF0C\\u4EE3\\u7801\\u5206\\u5272\\u529F\\u80FD\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword module\",children:\"import\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:'/* webpackChunkName: \"pageA\" */'}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'script/pageA'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"then\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token parameter\",children:\"module\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator arrow\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// \\u68C0\\u6D4B\\u8BE5\\u9875\\u9762\\u662F\\u5426\\u5DF2\\u6709\\u670D\\u52A1\\u5668\\u6E32\\u67D3\\u597D\\uFF0C\\u662F\\u7684\\u8BDD\\u76F4\\u63A5\\u8FD0\\u884C module.default\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// \\u5426\\u5219\\u52A0\\u8F7D\\u6A21\\u677F\\u548C\\u6570\\u636E\\u8FDB\\u884C\\u6E32\\u67D3\\uFF0C\\u6700\\u540E\\u518D\\u8C03\\u7528\\u9875\\u9762\\u51FD\\u6570\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"this\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"needRender\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"module\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword module\",children:\"default\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// \\u52A0\\u8F7D\\u6570\\u636E\\u65F6\\u8BBF\\u95EE\\u7684\\u5730\\u5740\\u5C31\\u662F\\u5F53\\u524D\\u51C6\\u5907\\u6E32\\u67D3\\u7684\\u9875\\u9762\\u5730\\u5740\\uFF0C\\u53EA\\u662F\\u52A0\\u4E0A\\u4E86 json=1 \\u7684\\u53C2\\u6570\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loadData\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'pageA'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"then\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token parameter\",children:\"data\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator arrow\",children:\"=>\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          res\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"render\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"xtpl\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" module\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword module\",children:\"default\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// \\u6355\\u6349 webpack \\u70ED\\u66F4\\u65B0\\uFF0C\\u8BA9\\u5B83\\u53EA\\u8FDB\\u884C\\u76F8\\u5F53\\u4E8E\\u9875\\u9762\\u8DF3\\u8F6C\\u7684\\u64CD\\u4F5C\\u800C\\u4E0D\\u662F\\u5237\\u65B0\\u9875\\u9762\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"module\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"hot\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  module\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"hot\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"accept\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'script/pageA'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator arrow\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    control\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"ROUTER\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"req\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"currentControl\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"call\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"ROUTER\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword nil null\",children:\"null\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"ROUTER\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"res\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"View \\u5C42\"}),(0,e.jsx)(n.p,{children:\"View \\u5C42\\u5373\\u6A21\\u677F\\uFF0C\\u8FD9\\u91CC\\u4F7F\\u7528\\u7684\\u662F xtpl \\u6A21\\u677F\\uFF0C\\u5728\\u670D\\u52A1\\u5668\\u73AF\\u5883\\u548C\\u524D\\u7AEF\\u73AF\\u5883\\u4E0B\\u90FD\\u652F\\u6301\\u6E32\\u67D3\\u9875\\u9762\\u3002\"}),(0,e.jsx)(n.p,{children:\"\\u9875\\u9762\\u51FD\\u6570\\u5F62\\u5F0F\\u5982\\u4E0B\\uFF1A\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword module\",children:\"default\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator arrow\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"window\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"addEventListener\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'scroll'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" fn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// \\u9875\\u9762\\u51FD\\u6570\\u652F\\u6301\\u8FD4\\u56DE\\u4E00\\u4E2A\\u5378\\u8F7D\\u51FD\\u6570\\uFF0C\\u5728\\u9875\\u9762\\u79BB\\u5F00\\u7684\\u65F6\\u5019\\u4F1A\\u88AB\\u8C03\\u7528\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// \\u4E3B\\u8981\\u7528\\u4E8E\\u5185\\u5B58\\u7684\\u91CA\\u653E\\u3001\\u5B9A\\u65F6\\u5668\\u7684\\u6E05\\u9664\\u3001\\u4E8B\\u4EF6\\u76D1\\u542C\\u7684\\u79FB\\u9664\\u7B49\\u7B49\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"window\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"removeEventListener\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'scroll'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" fn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\u540E\\u7AEF\\u90E8\\u5206\"}),(0,e.jsx)(n.p,{children:\"\\u540E\\u7AEF\\u90E8\\u5206\\u4F7F\\u7528 koa2 \\u642D\\u5EFA\\u6E32\\u67D3\\u670D\\u52A1\\u5668\\u3002\"}),(0,e.jsx)(n.p,{children:\"\\u5728\\u6536\\u5230\\u524D\\u7AEF\\u4F20\\u6765\\u7684\\u9875\\u9762\\u8BF7\\u6C42\\u65F6\\uFF1A\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:\"\\u5411 API \\u670D\\u52A1\\u5668\\u8BF7\\u6C42\\u6570\\u636E\\u3002\"}),(0,e.jsx)(n.li,{children:\"\\u8BC6\\u522B\\u9875\\u9762\\u8BF7\\u6C42\\u662F\\u5426\\u5E26\\u6709 json=1 \\u7684\\u53C2\\u6570\\uFF1A \\u2022 \\u5982\\u679C\\u5E26\\u6709\\u53C2\\u6570\\uFF1A\\u4E3A\\u524D\\u7AEF\\u8DEF\\u7531\\u8DF3\\u8F6C\\u65F6\\u7684\\u8BF7\\u6C42\\uFF0C\\u76F4\\u63A5\\u8FD4\\u56DE\\u6570\\u636E\\u5373\\u53EF\\u3002 \\u2022 \\u5982\\u679C\\u6CA1\\u6709\\u5E26\\u53C2\\u6570\\uFF1A\\u52A0\\u8F7D\\u4E0E\\u524D\\u7AEF\\u5171\\u7528\\u7684\\u6A21\\u677F\\uFF0C\\u914D\\u5408\\u6570\\u636E\\u8FDB\\u884C\\u6E32\\u67D3\\uFF0C\\u53D1\\u9001\\u5230\\u6D4F\\u89C8\\u5668\\u3002\"})]})]})}function p(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,{...a,children:(0,e.jsx)(d,{...a})}):d(a)}return y(x);})();\n;return Component;"
  },
  "_id": "blog/simple-js-fe-be.mdx",
  "_raw": {
    "sourceFilePath": "blog/simple-js-fe-be.mdx",
    "sourceFileName": "simple-js-fe-be.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/simple-js-fe-be"
  },
  "type": "Blog",
  "readingTime": {
    "text": "5 min read",
    "minutes": 4.92,
    "time": 295200,
    "words": 984
  },
  "slug": "simple-js-fe-be",
  "path": "blog/simple-js-fe-be",
  "filePath": "blog/simple-js-fe-be.mdx",
  "toc": [
    {
      "value": "什么是前后端同构",
      "url": "#什么是前后端同构",
      "depth": 1
    },
    {
      "value": "为什么需要前后端同构",
      "url": "#为什么需要前后端同构",
      "depth": 2
    },
    {
      "value": "项目简介",
      "url": "#项目简介",
      "depth": 1
    },
    {
      "value": "前端部分",
      "url": "#前端部分",
      "depth": 1
    },
    {
      "value": "Router 层",
      "url": "#router-层",
      "depth": 2
    }
  ],
  "structuredData": {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "简单前后端同构",
    "datePublished": "2018-02-28T00:00:00.000Z",
    "dateModified": "2018-02-28T00:00:00.000Z",
    "image": "/static/images/twitter-card.png",
    "url": "https://tailwind-nextjs-starter-blog.vercel.app/blog/simple-js-fe-be"
  }
}